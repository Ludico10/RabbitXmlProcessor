# RabbitXmlProcessor

Система состоит из двух сервисов:

* **FileParserService** – следит за папкой `input`, парсит XML-файлы и отправляет данные в RabbitMQ.
* **DataProcessorService** – получает сообщения из RabbitMQ и сохраняет их в SQLite-базу данных.
* **Shared** – общая для сервисов библиотека классов, содержит определения структур, находящихся в XML-файлах и методы взаимодействия сервисов через RabbitMQ.

---

## Алгоритм запуска
!Для запуска проекта вам понадобится Docker.

1. Склонируйте репозиторий:

   ```
   git clone https://github.com/username/repo.git
   cd repo
   ```

2. Соберите и запустите сервисы:

   ```
   docker-compose up --build
   ```

3. Для полного запуска необходимо около 30 секунд, после чего можно наблюдать логи:

   ```
   fileparser-1     | info: DirectoryMonitor[0]
   fileparser-1     |       Parsing started. Directory: ./input, interval: 1000ms.
   ```
   ```
   dataprocessor-1  | info: Shared.RabbitPostman[0]
   dataprocessor-1  |       Waiting for data started.
   ```

4. Доступы:

   * RabbitMQ Management UI → [http://localhost:15672](http://localhost:15672)
     логин: `guest`, пароль: `guest`
   * SQLite база сохраняется в папке `DataProcessorService/db`
   * для начала обработки файлы нужно поместить в директорию `FileParserService/input`
  
5. Для остановки сервисов воспользуйтесь сочитанием *ctrl + C*.

---

## Настройки конфигурации

Каждый сервис использует файл `appsettings.json`. В них содержится:
* *RabbitMq* - настройки RabbitMq. **Должны оставаться одинаковыми в обоих файлах и в docker-compose**.
* *Logging* - настройки логгирования (можно выводить логи в консоль и в файл).
* *DatabasePath* - указывает относительный путь к базе данных. Есть только в файле для DataProcessorService. **Рекомендуется изменять только название базы с сохранением пути**, так как в противном случае придется вносить дополнительные изменения в Dockerfile.
* *InputDirectory* - относительный путь к директории FileParserService по которому считываются файлы. Изменение также повлечет необходимость изменить Dockerfile.
* *MonitoringInterval* - промежуток времени в миллисекундах между запуском сканирования директории. Содержится только в файле сервиса FileParserService.
* *useFileHash* - флаг, обеспечивающий более точное отслеживание изменения файлов. Рекомендуется устанавливать в true только если ожидается переименовывание поступающих файлов, иначе может замедлить работу программы. Содержится только в файле сервиса FileParserService.

---

## Изменение конфигурации
!Будьте внимательны, не рекомендуется изменять параметры, отвечающие за пути, без готовности разбираться в Dockerfile сервисов.

1. Измените `appsettings.json`.
2. Пересоберите сервис:

   ```
   docker-compose up --build -d
   ```

---

## Логи

Посмотреть логи контейнеров можно :

```
docker logs -f fileparser
docker logs -f dataprocessor
```

---

## Тестирование

В директории **tests** можно найти Unit тесты для каждой библиотеки и сервиса. Рекомендуется к ознакомлению для глубокого понимания кода.

## Спасибо за внимание!
